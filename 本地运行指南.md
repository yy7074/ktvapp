# KTV预约系统 - 本地运行指南

## 📋 环境要求

### 前端环境
- HBuilderX 或其他uni-app开发工具
- 微信开发者工具（用于小程序调试）
- 现代浏览器（用于H5调试）

### 后端环境
- PHP 7.4 或更高版本
- MySQL 5.7 或更高版本
- 或者使用 XAMPP/MAMP/WAMP 集成环境

## 🚀 快速启动

### 方法一：使用集成环境（推荐）

#### 1. 安装XAMPP
```bash
# macOS
brew install --cask xampp

# Windows
下载并安装 https://www.apachefriends.org/
```

#### 2. 启动服务
```bash
# 启动XAMPP控制面板
# 开启 Apache 和 MySQL 服务
```

#### 3. 配置数据库
```bash
# 访问 http://localhost/phpmyadmin
# 或者使用命令行：
mysql -u root -p < ktv-api/init_db.sql
```

### 方法二：使用PHP内置服务器

#### 1. 启动数据库
```bash
# 确保MySQL服务运行
# macOS
brew services start mysql

# Ubuntu/Debian
sudo service mysql start

# Windows
net start mysql
```

#### 2. 初始化数据库
```bash
mysql -u root -p < ktv-api/init_db.sql
```

#### 3. 配置数据库连接
编辑 `ktv-api/config.php`:
```php
define('DB_HOST', 'localhost');
define('DB_USER', 'root');        // 你的数据库用户名
define('DB_PASS', '');            // 你的数据库密码
define('DB_NAME', 'ktv_booking');
```

#### 4. 启动后端服务器
```bash
# 使用提供的启动脚本
./start-backend.sh

# 或者手动启动
cd ktv-api
php -S localhost:3000
```

## 🖥️ 访问地址

### 后台管理系统
- **地址**: http://localhost:3000/admin/
- **账号**: admin
- **密码**: admin123

### API接口地址
- **基础地址**: http://localhost:3000/
- **测试接口**: http://localhost:3000/config.php

### 前端应用
- **开发调试**: 使用HBuilderX运行到浏览器或微信开发者工具

## 📊 数据库结构

### 主要数据表

1. **users** - 用户表
```sql
- id: 用户ID
- phone: 手机号（唯一）
- nickname: 昵称
- avatar: 头像
- vip_level: VIP等级
```

2. **bookings** - 预约表
```sql
- id: 预约ID
- user_id: 用户ID
- ktv_id: KTV商家ID
- ktv_name: KTV名称
- user_phone: 用户手机号
- booking_time: 预约时间
- room_type: 包厢类型
- people_count: 人数
- status: 状态(pending/confirmed/completed/cancelled)
```

3. **ktv_venues** - KTV商家表
```sql
- id: 商家ID
- name: 商家名称
- address: 地址
- phone: 联系电话
- rating: 评分
```

4. **admins** - 管理员表
```sql
- id: 管理员ID
- username: 用户名
- password: 密码
- name: 姓名
```

## 🔧 功能测试

### 前端功能测试

#### 1. 用户登录
```
手机号: 任意11位数字（如：18888888888）
验证码: 1234
```

#### 2. 预约流程
1. 登录后进入首页
2. 点击KTV列表中的"预约"按钮
3. 填写预约信息（时间、包厢、人数、备注）
4. 提交预约
5. 查看"我的预约"页面确认记录

#### 3. 预约管理
1. 进入"我的"页面
2. 点击"我的预约"
3. 查看预约列表
4. 可以取消待确认的预约

### 后台功能测试

#### 1. 管理员登录
```
访问: http://localhost:3000/admin/
用户名: admin
密码: admin123
```

#### 2. 数据统计
- 查看总预约数
- 查看各状态预约统计
- 查看用户数量

#### 3. 预约管理
- 查看预约列表
- 确认或取消预约
- 查看用户详细信息

## 📝 API接口列表

### 用户端接口
- `POST /send_code.php` - 发送验证码
- `POST /login.php` - 用户登录
- `GET /get_ktv_list.php` - 获取KTV列表
- `POST /create_booking.php` - 创建预约

### 管理端接口
- `POST /admin_login.php` - 管理员登录
- `GET /get_admin_stats.php` - 获取统计数据
- `GET /get_admin_bookings.php` - 获取预约列表
- `POST /update_booking_status.php` - 更新预约状态

## 🐛 常见问题

### 1. 数据库连接失败
```bash
# 检查MySQL服务是否启动
mysql -u root -p

# 检查数据库是否存在
SHOW DATABASES;
USE ktv_booking;
SHOW TABLES;
```

### 2. PHP服务器启动失败
```bash
# 检查PHP版本
php -v

# 检查端口是否被占用
lsof -i :3000

# 使用其他端口
php -S localhost:8000
```

### 3. 权限问题
```bash
# 给启动脚本执行权限
chmod +x start-backend.sh

# 检查文件权限
ls -la ktv-api/
```

### 4. 跨域问题
如果前端无法访问后端API，检查 `config.php` 中的CORS设置：
```php
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type, Authorization');
```

## 📱 前端配置

### 修改API地址
如果后端运行在不同端口，需要修改前端的API调用地址：

在登录页面 `pages/login/login.vue` 中：
```javascript
// 将 localhost 改为实际的服务器地址
const res = await uni.request({
    url: 'http://localhost:3000/ktv-api/login.php',
    // ...
});
```

## 🎯 生产部署

### 前端部署
1. 使用HBuilderX发行到各个平台
2. 微信小程序：上传到微信公众平台
3. H5：部署到Web服务器

### 后端部署
1. 上传PHP文件到服务器
2. 配置Apache/Nginx
3. 配置SSL证书
4. 修改数据库连接配置

---

**技术支持**: 如有问题请查看日志文件或联系开发团队 